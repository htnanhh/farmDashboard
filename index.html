<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard IFrame ERA</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f5fdf6;
      margin: 0;
      padding: 2rem;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 1.5rem;
    }
    .section {
      background: #e9fbe8;
      border: 2px dashed #43a047;
      border-radius: 12px;
      padding: 1rem 1.5rem;
    }
    .section h3 {
      margin-top: 0;
      color: #2e7d32;
    }
    .sensor {
      padding: 0.4rem 0;
      font-size: 15px;
    }
    .sensor span {
      font-weight: bold;
    }
    .btn {
      background: #4caf50;
      color: white;
      border: none;
      border-radius: 6px;
      padding: 0.6rem 1.2rem;
      margin: 0.3rem 0;
      width: 100%;
      font-size: 15px;
      cursor: pointer;
    }
    .btn:hover {
      background: #388e3c;
    }
  </style>
</head>
<body>
  <div class="grid">
    <div class="section">
      <h3>Node Điều Khiển 1 (Bơm)</h3>
      <button class="btn" onclick="sendCmd('NODE 1 - Relay 1', 'ON', 1)">🧯 Bơm nước</button>
      <button class="btn" onclick="sendCmd('NODE 1 - Relay 2', 'ON', 1)">🧪 Dung dịch A</button>
      <button class="btn" onclick="sendCmd('NODE 1 - Relay 3', 'ON', 1)">🧪 Dung dịch B</button>
      <button class="btn" onclick="sendCmd('NODE 1 - Relay 4', 'ON', 1)">🧪 Bơm HNO3</button>
    </div>

    <div class="section">
      <h3>Node Cảm Biến 1 (Đầu luống)</h3>
      <div class="sensor">🌡️ Nhiệt độ (DHT11): <span data-era-key="V4">--</span> °C</div>
      <div class="sensor">💧 Độ ẩm không khí: <span data-era-key="V5">--</span> %</div>
      <div class="sensor">🌱 Độ ẩm đất: <span data-era-key="V6">--</span> %</div>
      <div class="sensor">🌞 Ánh sáng: <span data-era-key="V3">--</span></div>
      <div class="sensor">⚡ Điện áp: <span data-era-key="V1">--</span> V</div>
      <div class="sensor">🔌 Dòng điện: <span data-era-key="V2">--</span> A</div>
      <div class="sensor">🧪 pH: <span data-era-key="V8">--</span></div>
      <div class="sensor">⚙️ EC: <span data-era-key="V7">--</span></div>
    </div>

    <div class="section">
      <h3>Node Điều Khiển 2 (Đèn chiếu sáng)</h3>
      <button class="btn" onclick="sendCmd('NODE 2 - Relay 1', 'ON', 1)">💡 Bóng đèn 1</button>
      <button class="btn" onclick="sendCmd('NODE 2 - Relay 2', 'ON', 1)">💡 Bóng đèn 2</button>
      <button class="btn" onclick="sendCmd('NODE 2 - Relay 3', 'ON', 1)">💡 Bóng đèn 3</button>
    </div>

    <div class="section">
      <h3>Node Cảm Biến 2 (Cuối luống)</h3>
      <div class="sensor">🌡️ Nhiệt độ (SHT20): <span data-era-key="V12">--</span> °C</div>
      <div class="sensor">💧 Độ ẩm không khí: <span data-era-key="V13">--</span> %</div>
      <div class="sensor">🌱 Độ ẩm đất: <span data-era-key="V14">--</span> %</div>
      <div class="sensor">🌞 Ánh sáng: <span data-era-key="V11">--</span></div>
      <div class="sensor">⚡ Điện áp: <span data-era-key="V9">--</span> V</div>
      <div class="sensor">🔌 Dòng điện: <span data-era-key="V10">--</span> A</div>
    </div>
  </div>

  <script>
    function sendCmd(device, action, value) {
      window.parent.postMessage({
        type: 'action',
        payload: {
          device,
          action,
          value
        }
      }, '*');
    }

    window.addEventListener("message", (event) => {
      const { type, payload } = event.data;
      if (type === "data") {
        for (let key in payload) {
          const el = document.querySelector(`[data-era-key='${key}']`);
          if (el) el.textContent = payload[key];
        }
      }
    });
  </script>
</body>
</html>
